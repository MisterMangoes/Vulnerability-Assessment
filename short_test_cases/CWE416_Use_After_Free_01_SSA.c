/*
Program description: In this program, data is allocated memory for 100 integers, which are all assigned as 5 using a for loop. Then, the memory that was allocated to data is freed. Finally, the first element of data is printed out 

Vulnerability and consequence: However, after data is deallocated with free, the program tries to print the first element of data, which causes a use after free error

The vulnerability triggers in the following lines:
printf("%d\n", data[0]);

Mitigation: To make this program safe to run, ensure that data is only freed after the first element of data is printed out. Therefore, only free data when there are no more uses for data. To check if the data has been freed or not, assign data to NULL after using free, then perform a NULL check
*/

#include <assert.h>

int main() {
	int dataFreed = 0;
	int * dataFreed_1 = &dataFreed;
	int * data = (int *)malloc(100 * sizeof(int));
	int * data_1 = &data[0];
	int i = 0;
	int * i_1 = &i;
	for(*i_1 = 0; i < 100; *i_1 = i + 1) {
		*(data_1 + i) = 5;
	}
	free(data);
	*dataFreed_1 = 1;
	assert(!dataFreed);
	printf("%d\n", data[0]);
	return 0;
}
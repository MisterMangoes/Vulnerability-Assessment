//CWE122_Heap_Based_Buffer_Overflow__sizeof_double_21

#include <cstdio>
#include <cstdlib>
#include <cassert>

static int badStatic = 0;

static double * badSource(double * data)
{
    if(badStatic)
    {
        /* INCIDENTAL: CWE-467 (Use of sizeof() on a pointer type) */
        /* FLAW: Using sizeof the pointer and not the data type in malloc() */
        data = (double *)malloc(sizeof(data));
        if (data == NULL) {exit(-1);}
        assert(sizeof(data) >= sizeof(double));
        *data = 1.7E300;
    }
    return data;
}

int main()
{
    double * data;
    /* Initialize data */
    data = NULL;
    badStatic = 1; /* true */
    data = badSource(data);
    /* POTENTIAL FLAW: Attempt to use data, which may not have enough memory allocated */
    printf("%g\n", *data);
    free(data);
    printf("%s\n", "finished");
    return 0;
}
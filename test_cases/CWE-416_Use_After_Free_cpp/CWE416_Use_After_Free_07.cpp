//CWE416_Use_After_Free__new_delete_wchar_t_64

#include <cstdio>
#include <cassert>

void badSink(void * dataVoidPtr)
{
    /* cast void pointer to a pointer of the appropriate type */
    wchar_t * * dataPtr = (wchar_t * *)dataVoidPtr;
    /* dereference dataPtr into data */
    wchar_t * data = (*dataPtr);
    /* POTENTIAL FLAW: Use of data that may have been deleted */
    assert(data != NULL);
    wchar_t s[2];
    s[0] = *data;
    s[1] = L'\0';
    printf("%ls\n", s);
    /* POTENTIAL INCIDENTAL - Possible memory leak here if data was not deleted */
}

int main()
{
    wchar_t * data;
    /* Initialize data */
    data = NULL;
    data = new wchar_t;
    *data = L'A';
    /* POTENTIAL FLAW: Delete data in the source - the bad sink attempts to use data */
    delete data;
    data = NULL;
    badSink(&data);
    printf("%s\n", "finished");
    return 0;
}
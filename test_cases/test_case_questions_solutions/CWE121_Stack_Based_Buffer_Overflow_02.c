/*
Program description: In this program, if globalString is equal to "helloworld", data is assigned a value from standard input with fgets() and buffer is initialized as an integer array of size 10 that is filled with 0's. Then, the element at index data in buffer is assigned as 9 and the elements of buffer is printed out with a for loop 

Vulnerability and consequence: However, there is no check to see if the index data is out of bounds for the buffer array. If data is assigned an integer greater than 9, the index will overrun the upper boundary of buffer and the program will overwrite adjacent memory with 9, thus causing a stack buffer overflow

The vulnerability triggers in the following lines:
buffer[data] = 9;

Mitigation: To make this program safe to run, ensure that the index data will not exceed the upper bound of the buffer array. Use an if condition to check if the data is a suitable index for buffer and it will not overrun the upper bound of the array to avoid overwriting adjacent memory
*/

#include <stdio.h>
#include <assert.h>

char* globalString = "helloworld";

int main() {
	int data = 0;
	if (!strncmp(globalString, "helloworld", 11)) {
		char inputBuffer[11] = "";
		int readCharacters = 10;
		//assert(readCharacters < 10);
		if (fgets(inputBuffer, readCharacters, stdin) != NULL) {
			data = atoi(inputBuffer); //convert to int
		}
		int buffer[10] = {0};
		//assert(data < sizeof(buffer)/sizeof(buffer[0]));
		buffer[data] = 9;
		//assert(readCharacters < 10);
		for(int i = 0; i < 10; i++) {
			//assert(buffer[i] != NULL);
			printf("%d\n", buffer[i]);
		}
	}
	return 0;
}

//Original file: CWE121_Stack_Based_Buffer_Overflow_02

/*
Question: Which of the following is correct? A
a) To catch this bug, the assertion at line 27 should be added
b) To catch this bug, the assertion at line 29 should be added
c) To catch this bug, the assertion at line 31 should be added
d) To catch this bug, the assertion at line 22 should be added
*/
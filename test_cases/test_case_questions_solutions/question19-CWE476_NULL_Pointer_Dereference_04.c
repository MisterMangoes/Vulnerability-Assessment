/*
Program description: In this program, data is allocated space for 5 characters and the string "A" is copied to data using strcpy(). Then, the memory that was allocated for data is reallocated using realloc() with a memory block size of either 0 or 1 (the value of zeroOrOne is random). The new pointer after reallocation using realloc() is dereferenced to print the string

Vulnerability and consequence: However, when using realloc(), if zeroOrOne is equal to 0, the size of the new memory block is 0, which fails the reallocation action so a NULL pointer is returned when using realloc(). Therefore, if realloc() returns NULL, a NULL pointer dereference occurs when printing the string that is pointed by reallocData

The vulnerability triggers in the following lines:
printf("%s\n", reallocData);

Mitigation: To make this program safe to run, ensure that reallocData is not set to NULL. Perform a NULL check to ensure that reallocData is not NULL. Additionally, ensure that the size argument for realloc() is a suitable value to prevent the function from returning a NULL pointer
*/

#include <stdlib.h>
#include <assert.h>

int globalReturnsZeroOrOne() {
	srand(time(0)); //use current time as seed
	return (rand() % 2);
}

int main() {
	int dataFreed = 0;
	char * data = NULL;
	data = (char *)malloc(5 * sizeof(char));
	strcpy(data, "A");
	int zeroOrOne = globalReturnsZeroOrOne();
	char * reallocData = NULL;
	reallocData = (char *)realloc(data, zeroOrOne);
	assert(reallocData != NULL);
	printf("%s\n", reallocData);
	free(data);
	dataFreed = 1;
	return 0;
}

//Original file: CWE476_NULL_Pointer_Dereference_04

/*
Question: Which of the following is correct? C
a) A null pointer dereference occurs at line 29 if zeroOrOne is 1
b) A heap buffer overflow occurs at line 29 if zeroOrOne is 1
c) A null pointer dereference occurs at line 29 if zeroOrOne is 0
d) A stack buffer overflow occurs at line 29 if zeroOrOne is 1
*/
/*
Program description: In this program, the struct structCharVoid contains two variables, structCharVoid->charFirst and structCharVoid->voidSecond. structCharVoid is allocated memory and strings are assigned to structCharVoid->charFirst and structCharVoid->voidSecond. Then, structCharVoid is set to NULL and structCharVoid->charFirst and structCharVoid->voidSecond is printed out

Vulnerability and consequence: However, after structCharVoid is set to NULL, it is dereferenced to print out structCharVoid->charFirst and structCharVoid->voidSecond. Therefore, a NULL pointer dereference occurs

The vulnerability triggers in the following lines:
printf("%s\n", (char *)structCharVoid->charFirst);

Mitigation: To make this program safe to run, ensure that structCharVoid is not set to NULL if there are more uses. Perform a NULL check to ensure that structCharVoid is not NULL
*/

#include <stdlib.h>
#include <assert.h>

static const int STATIC_CONST_TRUE = 1;

typedef struct _charVoid {
	char charFirst[4];
	void * voidSecond;
} charVoid;

int main() {
	if(STATIC_CONST_TRUE) {
		charVoid * structCharVoid = NULL;
		structCharVoid = (charVoid *)malloc(sizeof(charVoid));
		structCharVoid->voidSecond = (void *)"abc";
		memcpy(structCharVoid->charFirst, "efg", 3);
		structCharVoid->charFirst[(sizeof(structCharVoid->charFirst)/sizeof(char))-1] = '\0';
		structCharVoid = NULL;
		assert(structCharVoid != NULL);
		printf("%s\n", (char *)structCharVoid->charFirst);
		printf("%s\n", (char *)structCharVoid->voidSecond);
		free(structCharVoid);
	}
	return 0;
}

//Original file: CWE476_NULL_Pointer_Dereference_03

/*
Question: Which of the following is correct? D
a) A heap buffer overflow occurs at line 27
b) A heap buffer overflow occurs at line 26
c) A null pointer dereference occurs at line 32
d) A null pointer derference occurs at line 31
*/
/*
Program description: In this program, a random integer from 0 to 19 is assigned to data. Then, data is used as the index for buffer, which is an integer array with a size of 5 and it is filled with 0's. If data is greater than 0, then the element at index data for buffer is assigned to 1. Otherwise, if data is not greater than 0, the program prints an error message and none of the integers in buffer are changed

Vulnerability and consequence: However, there is no check to see if the index data is out of bounds for the buffer array. If data is assigned an integer greater than 4, the index will overrun the upper boundary of buffer and the program will overwrite adjacent memory with 1, thus causing a stack buffer overflow

The vulnerability triggers in the following lines:
buffer[data] = 1;

Mitigation: To make this program safe to run, ensure that the index data will not exceed the upper bound of the buffer array. Use an if condition to check if the data is a suitable index for buffer and it will not overrun the upper bound of the array to avoid overwriting adjacent memory
*/

#include <stdlib.h>
#include <assert.h>

int main() {
	srand(time(0)); //use current time as random seed
	int data = rand() % 20;
	printf("Random number: %d\n", data);
	int buffer[5];
	memset(buffer, 0, 5 * sizeof(int));
	if (data > 0) {
		assert(data < sizeof(buffer)/sizeof(buffer[0]));
		int * buffer_1 = &buffer[data];
		*buffer_1 = 1;
		int i = 0;
		int * i_1 = &i;
		for(*i_1 = 0; i < 5; *i_1 = i + 1) {
			printf("%d\n", buffer[i]);
		}
	}
	return 0;
}